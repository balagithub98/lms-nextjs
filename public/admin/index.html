<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LMS Content Manager</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
      line-height: 1.6;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    .header {
      background: #007bff;
      color: white;
      padding: 20px;
      text-align: center;
    }
    .content {
      padding: 30px;
    }
    .section {
      margin-bottom: 30px;
      padding: 20px;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      background: #f8f9fa;
    }
    .section h3 {
      margin-top: 0;
      color: #007bff;
    }
    .btn {
      display: inline-block;
      padding: 12px 24px;
      background: #007bff;
      color: white;
      text-decoration: none;
      border-radius: 5px;
      margin: 5px;
      border: none;
      cursor: pointer;
      font-size: 14px;
    }
    .btn:hover {
      background: #0056b3;
    }
    .btn-success {
      background: #28a745;
    }
    .btn-success:hover {
      background: #1e7e34;
    }
    .btn-warning {
      background: #ffc107;
      color: #212529;
    }
    .btn-warning:hover {
      background: #e0a800;
    }
    .status {
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
    }
    .status.success {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }
    .status.error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }
    .status.warning {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      color: #856404;
    }
    .file-list {
      background: white;
      border: 1px solid #dee2e6;
      border-radius: 5px;
      padding: 15px;
      margin: 10px 0;
    }
    .file-item {
      padding: 8px 0;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .file-item:last-child {
      border-bottom: none;
    }
    .file-path {
      font-family: monospace;
      color: #666;
    }
    .actions {
      display: flex;
      gap: 10px;
    }
    .actions a {
      padding: 4px 8px;
      font-size: 12px;
      text-decoration: none;
      border-radius: 3px;
    }
    .actions .edit {
      background: #007bff;
      color: white;
    }
    .actions .view {
      background: #28a745;
      color: white;
    }
    .actions .delete {
      background: #dc3545;
      color: white;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
    }
    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ced4da;
      border-radius: 4px;
      font-size: 14px;
    }
    .form-group textarea {
      height: 100px;
      resize: vertical;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üéì LMS Content Manager</h1>
      <p>Manage your learning management system content</p>
    </div>
    
    <div class="content">
      <!-- Status Section -->
      <div class="section">
        <h3>üìä System Status</h3>
        <div id="status-container">
          <div class="status warning">
            <strong>Loading...</strong> Checking system status...
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="section">
        <h3>‚ö° Quick Actions</h3>
        <p>Common content management tasks:</p>
        <button class="btn" onclick="refreshContent()">üîÑ Refresh Content</button>
        <button class="btn" onclick="showCreateForm()">‚ûï Create New Module</button>
        <button class="btn" onclick="exportContent()">üì§ Export Content</button>
        <button class="btn btn-warning" onclick="showGitStatus()">üìã Git Status</button>
      </div>

      <!-- Content Browser -->
      <div class="section">
        <h3>üìÅ Content Browser</h3>
        <div id="content-browser">
          <div class="status warning">
            <strong>Loading...</strong> Scanning content directory...
          </div>
        </div>
      </div>

      <!-- Create Module Form (Hidden by default) -->
      <div id="create-form" class="section hidden">
        <h3>‚ûï Create New Module</h3>
        <form id="module-form">
          <div class="form-group">
            <label for="exam-slug">Exam Slug:</label>
            <input type="text" id="exam-slug" placeholder="e.g., jee, neet" required>
          </div>
          <div class="form-group">
            <label for="subject-slug">Subject Slug:</label>
            <input type="text" id="subject-slug" placeholder="e.g., mathematics, physics" required>
          </div>
          <div class="form-group">
            <label for="unit-slug">Unit Slug:</label>
            <input type="text" id="unit-slug" placeholder="e.g., derivatives, mechanics" required>
          </div>
          <div class="form-group">
            <label for="chapter-slug">Chapter Slug:</label>
            <input type="text" id="chapter-slug" placeholder="e.g., basic-rules, kinematics" required>
          </div>
          <div class="form-group">
            <label for="module-number">Module Number:</label>
            <input type="number" id="module-number" min="1" value="1" required>
          </div>
          <div class="form-group">
            <label for="module-title">Module Title:</label>
            <input type="text" id="module-title" placeholder="e.g., Basic Derivative Rules" required>
          </div>
          <div class="form-group">
            <label for="module-content">Content HTML:</label>
            <textarea id="module-content" placeholder="Enter HTML content here..."></textarea>
          </div>
          <button type="submit" class="btn btn-success">Create Module</button>
          <button type="button" class="btn" onclick="hideCreateForm()">Cancel</button>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Initialize the admin interface
    document.addEventListener('DOMContentLoaded', function() {
      checkSystemStatus();
      loadContentBrowser();
    });

    // Check system status
    async function checkSystemStatus() {
      const statusContainer = document.getElementById('status-container');
      
      try {
        // Check auth endpoint
        const authResponse = await fetch('/api/test-auth');
        const authData = await authResponse.json();
        
        let statusHtml = '<div class="status success"><strong>‚úÖ System Online</strong><br>';
        statusHtml += `Environment Variables: ${authData.hasClientId && authData.hasClientSecret ? '‚úÖ Set' : '‚ùå Missing'}<br>`;
        statusHtml += `Auth Endpoint: ‚úÖ Working<br>`;
        statusHtml += `Content Directory: ‚úÖ Accessible<br>`;
        statusHtml += '</div>';
        
        statusContainer.innerHTML = statusHtml;
      } catch (error) {
        statusContainer.innerHTML = `
          <div class="status error">
            <strong>‚ùå System Error</strong><br>
            Failed to connect to backend: ${error.message}
          </div>
        `;
      }
    }

    // Load content browser
    async function loadContentBrowser() {
      const browserContainer = document.getElementById('content-browser');
      
      try {
        // This would normally fetch from an API endpoint
        // For now, show a static example
        browserContainer.innerHTML = `
          <div class="file-list">
            <div class="file-item">
              <div>
                <strong>JEE Mathematics - Derivatives</strong><br>
                <span class="file-path">data/jee/mathematics/derivatives/basic-rules/module-1/</span>
              </div>
              <div class="actions">
                <a href="/jee/mathematics/derivatives/basic-rules/module-1" class="view">View</a>
                <a href="#" class="edit">Edit</a>
                <a href="#" class="delete">Delete</a>
              </div>
            </div>
            <div class="file-item">
              <div>
                <strong>JEE Mathematics - Limits</strong><br>
                <span class="file-path">data/jee/mathematics/limits/continuity/module-1/</span>
              </div>
              <div class="actions">
                <a href="/jee/mathematics/limits/continuity/module-1" class="view">View</a>
                <a href="#" class="edit">Edit</a>
                <a href="#" class="delete">Delete</a>
              </div>
            </div>
            <div class="file-item">
              <div>
                <strong>NEET Biology - Cell Biology</strong><br>
                <span class="file-path">data/neet/biology/cell-biology/cell-structure/module-1/</span>
              </div>
              <div class="actions">
                <a href="/neet/biology/cell-biology/cell-structure/module-1" class="view">View</a>
                <a href="#" class="edit">Edit</a>
                <a href="#" class="delete">Delete</a>
              </div>
            </div>
          </div>
          <p><em>üí° Tip: Click "View" to see the module, "Edit" to modify content, or "Delete" to remove.</em></p>
        `;
      } catch (error) {
        browserContainer.innerHTML = `
          <div class="status error">
            <strong>‚ùå Failed to load content</strong><br>
            ${error.message}
          </div>
        `;
      }
    }

    // Show create form
    function showCreateForm() {
      document.getElementById('create-form').classList.remove('hidden');
    }

    // Hide create form
    function hideCreateForm() {
      document.getElementById('create-form').classList.add('hidden');
      document.getElementById('module-form').reset();
    }

    // Handle form submission
    document.getElementById('module-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = {
        exam_slug: document.getElementById('exam-slug').value,
        subject_slug: document.getElementById('subject-slug').value,
        unit_slug: document.getElementById('unit-slug').value,
        chapter_slug: document.getElementById('chapter-slug').value,
        module_number: parseInt(document.getElementById('module-number').value),
        title: document.getElementById('module-title').value,
        content_html: document.getElementById('module-content').value
      };
      
      // This would normally send to an API endpoint
      alert('Module creation would be implemented here. Form data: ' + JSON.stringify(formData, null, 2));
      hideCreateForm();
    });

    // Refresh content
    function refreshContent() {
      loadContentBrowser();
      alert('Content refreshed!');
    }

    // Export content
    function exportContent() {
      alert('Export functionality would be implemented here.');
    }

    // Show git status
    function showGitStatus() {
      alert('Git status functionality would be implemented here.');
    }
  </script>
</body>
</html>